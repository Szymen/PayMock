(function(e){var f=(e.browser.msie?"paste":"input")+".mask";var d=(window.orientation!=undefined);e.mask={definitions:{"9":"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}};e.fn.extend({caret:function(b,a){if(this.length==0){return}if(typeof b=="number"){a=(typeof a=="number")?a:b;return this.each(function(){if(this.setSelectionRange){this.focus();this.setSelectionRange(b,a)}else{if(this.createTextRange){var h=this.createTextRange();h.collapse(true);h.moveEnd("character",a);h.moveStart("character",b);h.select()}}})}else{if(this[0].setSelectionRange){b=this[0].selectionStart;a=this[0].selectionEnd}else{if(document.selection&&document.selection.createRange){var c=document.selection.createRange();b=0-c.duplicate().moveStart("character",-100000);a=b+c.text.length}}return{begin:b,end:a}}},unmask:function(){return this.trigger("unmask")},mask:function(b,p){if(!b&&this.length>0){var n=e(this[0]);var m=n.data("tests");return e.map(n.data("buffer"),function(h,g){return m[g]?h:null}).join("")}p=e.extend({placeholder:"_",completed:null},p);var a=e.mask.definitions;var m=[];var o=b.length;var c=null;var l=b.length;e.each(b.split(""),function(g,h){if(h=="?"){l--;o=g}else{if(a[h]){m.push(new RegExp(a[h]));if(c==null){c=m.length-1}}else{m.push(null)}}});return this.each(function(){var g=e(this);var x=e.map(b.split(""),function(q,r){if(q!="?"){return a[q]?p.placeholder:q}});var k=false;var h=g.val();g.data("buffer",x).data("tests",m);function A(q){while(++q<=l&&!m[q]){}return q}function C(q){while(!m[q]&&--q>=0){}for(var s=q;s<l;s++){if(m[s]){x[s]=p.placeholder;var r=A(s);if(r<l&&m[s].test(x[r])){x[s]=x[r]}else{break}}}D();g.caret(Math.max(c,q))}function B(u){for(var r=u,s=p.placeholder;r<l;r++){if(m[r]){var t=A(r);var q=x[r];x[r]=s;if(t<l&&m[t].test(q)){s=q}else{break}}}}function y(s){var q=e(this).caret();var r=s.keyCode;k=(r<16||(r>16&&r<32)||(r>32&&r<41));if((q.begin-q.end)!=0&&(!k||r==8||r==46)){z(q.begin,q.end)}if(r==8||r==46||(d&&r==127)){C(q.begin+(r==46?0:-1));return false}else{if(r==27){g.val(h);g.caret(0,i());return false}}}function j(v){if(k){k=false;return(v.keyCode==8)?false:null}v=v||window.event;var t=v.charCode||v.keyCode||v.which;var s=e(this).caret();if(v.ctrlKey||v.altKey||v.metaKey){return true}else{if((t>=32&&t<=125)||t>186){var r=A(s.begin-1);if(r<l){var q=String.fromCharCode(t);if(m[r].test(q)){B(r);x[r]=q;D();var u=A(r);e(this).caret(u);if(p.completed&&u==l){p.completed.call(g)}}}}}return false}function z(q,s){for(var r=q;r<s&&r<l;r++){if(m[r]){x[r]=p.placeholder}}}function D(){return g.val(x.join("")).val()}function i(v){var t=g.val();var s=-1;for(var u=0,r=0;u<l;u++){if(m[u]){x[u]=p.placeholder;while(r++<t.length){var q=t.charAt(r-1);if(m[u].test(q)){x[u]=q;s=u;break}}if(r>t.length){break}}else{if(x[u]==t[r]&&u!=o){r++;s=u}}}if(!v&&s+1<o){g.val("");z(0,l)}else{if(v||s+1>=o){D();if(!v){g.val(g.val().substring(0,s+1))}}}return(o?u:c)}if(!g.attr("readonly")){g.one("unmask",function(){g.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){h=g.val();var q=i();D();setTimeout(function(){if(q==b.length){g.caret(0,q)}else{g.caret(q)}},0)}).bind("blur.mask",function(){i();if(g.val()!=h){g.change()}}).bind("keydown.mask",y).bind("keypress.mask",j).bind(f,function(){setTimeout(function(){g.caret(i(true))},0)})}i()})}})})(jQuery);