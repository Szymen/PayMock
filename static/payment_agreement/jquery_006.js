/*!
 * v0.0.9
 * Copyright (c) 2013 First Opinion
 * formatter.js is open sourced under the MIT license.
 *
 * thanks to digitalBush/jquery.maskedinput for some of the trickier
 * keycode handling
 */
!function(D,C,B){function A(f,e){var h=this;if(h.el=f,!h.el){throw new TypeError("Must provide an existing element")}if(h.opts=s.extend({},z,e),"undefined"==typeof h.opts.pattern){throw new TypeError("Must provide a pattern")}var g=x.parse(h.opts.pattern);h.mLength=g.mLength,h.chars=g.chars,h.inpts=g.inpts,h.hldrs={},h.focus=0,s.addListener(h.el,"keydown",function(b){h._keyDown(b)}),s.addListener(h.el,"keypress",function(b){h._keyPress(b)}),s.addListener(h.el,"paste",function(b){h._paste(b)}),h.opts.persistent&&(h._processKey("",!1),h.el.blur(),s.addListener(h.el,"focus",function(b){h._focus(b)}),s.addListener(h.el,"click",function(b){h._focus(b)}),s.addListener(h.el,"touchstart",function(b){h._focus(b)}))}var z={persistent:!1,repeat:!1,placeholder:" "},y={9:/[0-9]/,a:/[A-Za-z]/,"*":/[A-Za-z0-9]/};A.addInptType=function(d,c){y[d]=c},A.prototype.resetPattern=function(d){this.opts.pattern=d,this.sel=t.get(this.el),this.val=this.el.value,this.delta=0,this._removeChars();var c=x.parse(d);this.mLength=c.mLength,this.chars=c.chars,this.inpts=c.inpts,this._processKey("",!1)},A.prototype._keyDown=function(d){var c=d.which||d.keyCode;return c&&s.isDelKey(c)?(this._processKey(null,c),s.preventDefault(d)):void 0},A.prototype._keyPress=function(e){var d,f;return e.which?d=e.which:(d=e.keyCode,f=s.isSpecialKey(d)),s.isDelKey(d)||f||s.isModifier(e)?void 0:(this._processKey(String.fromCharCode(d),!1),s.preventDefault(e))},A.prototype._paste=function(b){return this._processKey(s.getClip(b),!1),s.preventDefault(b)},A.prototype._focus=function(){var b=this;setTimeout(function(){var a=t.get(b.el),d=a.end>b.focus;isFirstChar=0===a.end,(d||isFirstChar)&&t.set(b.el,b.focus)},0)},A.prototype._processKey=function(d,c){if(this.sel=t.get(this.el),this.val=this.el.value,this.delta=0,this.sel.begin!==this.sel.end){this.delta=-1*Math.abs(this.sel.begin-this.sel.end),this.val=s.removeChars(this.val,this.sel.begin,this.sel.end)}else{if(c&&46==c){this._delete()}else{if(c&&this.sel.begin-1>=0){this.val=s.removeChars(this.val,this.sel.end-1,this.sel.end),this.delta=-1}else{if(c){return !0}}}}c||(this.val=s.addChars(this.val,d,this.sel.begin),this.delta+=d.length),this._formatValue()},A.prototype._delete=function(){for(;this.chars[this.sel.begin];){this._nextPos()}this.sel.begin<this.val.length&&(this._nextPos(),this.val=s.removeChars(this.val,this.sel.end-1,this.sel.end),this.delta=-1)},A.prototype._nextPos=function(){this.sel.end++,this.sel.begin++},A.prototype._formatValue=function(){this.newPos=this.sel.end+this.delta,this._removeChars(),this._validateInpts(),this._addChars(),this.el.value=this.val.substr(0,this.mLength),t.set(this.el,this.newPos)},A.prototype._removeChars=function(){this.sel.end>this.focus&&(this.delta+=this.sel.end-this.focus);for(var h=0,g=0;g<=this.mLength;g++){var l,k=this.chars[g],j=this.hldrs[g],i=g+h;i=g>=this.sel.begin?i+this.delta:i,l=this.val.charAt(i),(k&&k==l||j&&j==l)&&(this.val=s.removeChars(this.val,i,i+1),h--)}this.hldrs={},this.focus=this.val.length},A.prototype._validateInpts=function(){for(var g=0;g<this.val.length;g++){var f=this.inpts[g],j=!y[f],i=!j&&!y[f].test(this.val.charAt(g)),h=this.inpts[g];(j||i)&&h&&(this.val=s.removeChars(this.val,g,g+1),this.focusStart--,this.newPos--,this.delta--,g--)}},A.prototype._addChars=function(){if(this.opts.persistent){for(var d=0;d<=this.mLength;d++){this.val.charAt(d)||(this.val=s.addChars(this.val,this.opts.placeholder,d),this.hldrs[d]=this.opts.placeholder),this._addChar(d)}for(;this.chars[this.focus];){this.focus++}}else{for(var c=0;c<=this.val.length;c++){if(this.delta<=0&&c==this.focus){return !0}this._addChar(c)}}},A.prototype._addChar=function(d){var c=this.chars[d];return c?(s.isBetween(d,[this.sel.begin-1,this.newPos+1])&&(this.newPos++,this.delta++),d<=this.focus&&this.focus++,this.hldrs[d]&&(delete this.hldrs[d],this.hldrs[d+1]=this.opts.placeholder),this.val=s.addChars(this.val,c,d),void 0):!0};var x={},w=4,v=new RegExp("{{([^}]+)}}","g"),u=function(e){for(var d,f=[];d=v.exec(e);){f.push(d)}return f};x.parse=function(j){var h={inpts:{},chars:{}},E=u(j),o=j.length,n=0,m=0,l=0,k=function(b){for(var f=b.length,e=0;f>e;e++){h.inpts[m]=b.charAt(e),m++}n++,l+=b.length+w-1};for(l;o>l;l++){l==E[n].index?k(E[n][1]):h.chars[l-n*w]=j.charAt(l)}return h.mLength=l-n*w,h};var t={};t.get=function(g){if("number"==typeof g.selectionStart){return{begin:g.selectionStart,end:g.selectionEnd}}var c=B.selection.createRange();if(c&&c.parentElement()==g){var j=g.createTextRange(),i=g.createTextRange(),h=g.value.length;return j.moveToBookmark(c.getBookmark()),i.collapse(!1),j.compareEndPoints("StartToEnd",i)>-1?{begin:h,end:h}:{begin:-j.moveStart("character",-h),end:-j.moveEnd("character",-h)}}return{begin:0,end:0}},t.set=function(e,d){if(e.setSelectionRange){e.focus(),e.setSelectionRange(d,d)}else{if(e.createTextRange){var f=e.createTextRange();f.collapse(!0),f.moveEnd("character",d),f.moveStart("character",d),f.select()}}};var s={},r="undefined"!=typeof navigator?navigator.userAgent:null,q=/iphone/i.test(r);s.extend=function(e){for(var d=1;d<arguments.length;d++){for(var f in arguments[d]){e[f]=arguments[d][f]}}return e},s.addChars=function(e,d,f){return e.substr(0,f)+d+e.substr(f,e.length)},s.removeChars=function(e,d,f){return e.substr(0,d)+e.substr(f,e.length)},s.isBetween=function(d,c){return c.sort(function(f,e){return f-e}),d>c[0]&&d<c[1]},s.addListener=function(e,d,f){return"undefined"!=typeof e.addEventListener?e.addEventListener(d,f,!1):e.attachEvent("on"+d,f)},s.preventDefault=function(b){return b.preventDefault?b.preventDefault():b.returnValue=!1},s.getClip=function(b){return b.clipboardData?b.clipboardData.getData("Text"):C.clipboardData?C.clipboardData.getData("Text"):void 0},s.isDelKey=function(b){return 8===b||46===b||q&&127===b},s.isSpecialKey=function(d){var c={9:"tab",13:"enter",35:"end",36:"home",37:"leftarrow",38:"uparrow",39:"rightarrow",40:"downarrow",116:"F5"};return c[d]},s.isModifier=function(b){return b.ctrlKey||b.altKey||b.metaKey};var p="formatter";D.fn[p]=function(a){return"object"==typeof a&&this.each(function(){D.data(this,"plugin_"+p)||D.data(this,"plugin_"+p,new A(this,a))}),this.resetPattern=function(c){return this.each(function(){var b=D.data(this,"plugin_"+p);b&&b.resetPattern(c)}),this},this},D.fn[p].addInptType=function(d,c){A.addInptType(d,c)}}(jQuery,window,document);